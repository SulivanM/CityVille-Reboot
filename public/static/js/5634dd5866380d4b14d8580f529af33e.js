function OverlayManager(){this.overlayOpen=false;this.currentOverlay={};this.hasForced=false;this.queue=[];this.farmOverlay=new FarmOverlay();this.overlay_holder="my_overlay_holder";this.isZSCOpen=false;this.pumpTimeout=null}OverlayManager.prototype.setZSCOpen=function(){this.isZSCOpen=true};OverlayManager.prototype.setZSCClose=function(){this.isZSCOpen=false;this.schedulePumpQueue()};OverlayManager.prototype.isOverlayActive=function(){return this.overlayOpen};OverlayManager.prototype.queueSize=function(){return this.queue.length};OverlayManager.prototype.pumpQueue=function(){if(!this.canOpenNextQueuedOverlay()){return}var c;if(this.hasForced){var a=this.queue.length;var f;for(var e=0;e<a;e++){f=this.queue[e];if(f.force==true){this.queue.splice(e,1);c=f;break}}}if(!c){c=this.queue.shift()}if(c){this.currentOverlay=c;if(typeof c.strOrFunc=="string"){var g=new Date();var b=ZY.PrepareURL(c.strOrFunc);b=APP_URL+b;b+="&d="+g.getTime();b+="&isOuterIframe=0";this.farmOverlay.showGameOverlay(b,c.force)}else{if(c.params){c.strOrFunc(c.params)}else{c.strOrFunc()}}}this.overlayOpen=true};OverlayManager.prototype.queueOverlay=function(d,e,b,g,h){if(this.overlayOpen&&this.currentOverlay!=null&&this.currentOverlay.uid==d){return}var a=this.queue.length;for(var c=0;c<a;++c){if(this.queue[c].uid==d){return}}var f={};f.uid=d;f.strOrFunc=e;f.params=h;if(g==null){f.force=false}else{f.force=g;if(g==true){this.hasForced=true}}f.cbfunc=b;this.queue.push(f);this.schedulePumpQueue()};OverlayManager.prototype.onOverlayClosed=function(){if(this.overlayOpen==true){if(typeof this.currentOverlay.cbfunc=="function"){this.currentOverlay.cbfunc()}this.overlayOpen=false;if(typeof this.currentOverlay.strOrFunc=="string"){this.farmOverlay.hideGameOverlay()}this.currentOverlay=null;this.schedulePumpQueue()}};OverlayManager.prototype.canOpenNextQueuedOverlay=function(){return !this.overlayOpen&&!this.isZSCOpen&&this.queue.length>0};OverlayManager.prototype.schedulePumpQueue=function(){if(this.canOpenNextQueuedOverlay()&&this.pumpTimeout==null){var a=this;this.pumpTimeout=setTimeout(function(){a.pumpTimeout=null;a.pumpQueue()},0)}};var __OverlayManager=null;function getOverlayManager(){if(__OverlayManager==null){__OverlayManager=new OverlayManager()}return __OverlayManager};