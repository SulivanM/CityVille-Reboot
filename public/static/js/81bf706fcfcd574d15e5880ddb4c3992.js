$(window).load(function(){var a=$("#flashapp")[0];var c=function(d){var f=0;if(d.wheelDelta){f=d.wheelDelta/120;if(window.opera){f=-f}}else{if(d.detail){f=-d.detail*3}}this.onMouseWheel&&this.onMouseWheel(f);d.stopPropagation();d.preventDefault()};var b=function(d){var f=document.getElementById("flashapp");if(f&&f.onFocus&&typeof f.onFocus=="function"){f.onFocus()}};if(a){if(a.addEventListener){a.addEventListener("DOMMouseScroll",c,false);a.addEventListener("mousewheel",c,false);a.addEventListener("mouseover",b,false)}else{if(a.attachEvent){a.attachEvent("onmousewheel",c);a.attachEvent("onmouseover",b)}}}});function enableAllInput(){document.getElementById("flashapp").enableAllInput()}function disableAllInput(){document.getElementById("flashapp").disableAllInput()}function onAcceptInvite(a){}function showFeedDialog(b,d,a,c){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}FB.ensureInit(function(){var e=FB.Connect.showFeedDialog(b,d,a,null,null,FB.RequireConnect.require,onFeedClosed,d.user_message_prompt,null);if(e){document.getElementById("flashapp").logShowFeedDialog();disableAllInput()}})}function onFeedClosed(){if(experiment_wmode){ZYFrameManager.hideScreenshot()}enableAllInput();document.getElementById("flashapp").logCloseFeedDialog()}function streamPublish(h,e,c,a,d){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}var b,g;if(c!=null){var f=c.split(":");if(f.length==1){b=c;g=1}else{g=parseInt(f[0]);b=f[1]}}if(g==1){FB.ensureInit(function(){var i=FB.Connect.streamPublish("",h,e,b,userMessagePrompt,onStreamClosed,d);if(i){document.getElementById("flashapp").logShowFeedDialog();if(!d){disableAllInput()}}})}}function snapiStreamPublish(c){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}if(typeof g_locale=="undefined"){g_locale=null}var b=g_locale||g_userInfo.locale||"en_US";c.locale=b;try{var a=SNAPI.api("stream.publish",{payload:JSON.stringify(c)},onStreamClosed)}catch(d){ZStatsCount("stream_publish","failure","js",d.message)}}function fbFeedShareViaLink(b,a){var d={link:a,title:b.full.title,description:b.full.description,icon:b.full.media.src};try{FB.api("/me/links/","post",d,function(e){if(e&&e.id){}else{ZStatsCount("feed_via_link","error")}})}catch(c){ZStatsCount("feed_via_link","error",c.message)}}function snapiAwardXp(a){try{SNAPI.api("points.grantXP",a)}catch(b){}}function onStreamClosedThawOnly(a){if(experiment_wmode){ZYFrameManager.hideScreenshot()}document.getElementById("flashapp").thawGame()}function onStreamClosed(a){if(experiment_wmode){ZYFrameManager.hideScreenshot()}if(a){if(a.error_code!=null){if(a.error_code=="341"){}ZStatsCount("stream_publish","failure","js",a.error_code)}else{if(a.post_id){ZStatsCount("stream_publish","success","js")}else{ZStatsCount("stream_publish","failure","js","response_no_post_id")}}}else{ZStatsCount("stream_publish","cancel","js")}enableAllInput()}function onFrameLoaded(){var a=document.getElementById("flashapp");if(a&&a.frameLoadComplete&&typeof a.frameLoadComplete=="function"){a.frameLoadComplete()}}function showStreamPermissions(a,b){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}if(SNAPI_ENABLE){SNAPI.ui("showPermissionDialog",{perms:a},function(d){var c=b||onPermissionDialogClosed;c(a,d)})}}function showStreamExtendedPermissions(a){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}if(SNAPI_ENABLE){SNAPI.ui("showPermissionDialog",{perms:"publish_actions,user_games_activity,friends_games_activity"},a?a:onExtendedPermissionDialogClosed)}}function showPostTOSPermissions(a){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}if(SNAPI_ENABLE){SNAPI.ui("showPermissionDialog",{perms:"publish_actions,user_games_activity,friends_games_activity"},function(){if(experiment_wmode){ZYFrameManager.hideScreenshot()}enableAllInput();document.getElementById("flashapp").onShowPostTOSPermissionsClose(a)})}}function showCIPPermissions(){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}if(typeof(FB)!=="undefined"){FB.login(function(a){FB.api("/me/permissions",{limit:0},function(h){var g=h.data[0];var e=true;var f=new Array("publish_actions","email");var j=f.length;for(var d=0;d<j;d++){var c=f[d];if(!g.hasOwnProperty(c)||g[c]!=1){e=false;break}}var b=onCIPPermissionDialogClosed;b(e)})},{scope:"publish_actions,email"})}}function onCIPPermissionDialogClosed(a){if(experiment_wmode){ZYFrameManager.hideScreenshot()}enableAllInput();var b=getFlashApp();if(b&&b.cipPermissionDialogClosed){b.cipPermissionDialogClosed(a)}}function onPermissionDialogClosed(b,a){if(experiment_wmode){ZYFrameManager.hideScreenshot()}enableAllInput();document.getElementById("flashapp").permissionDialogClosed(b,a)}function onExtendedPermissionDialogClosed(a){if(experiment_wmode){ZYFrameManager.hideScreenshot()}enableAllInput();document.getElementById("flashapp").extendedPermissionsDialogClosed()}function showBookmarkDialog(a){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}if(SNAPI_ENABLE){SNAPI.ui("showBookmarkDialog",a)}else{FB.ensureInit(function(){FB.Connect.showBookmarkDialog()})}}function showEmailPermission(a){if(experiment_wmode){ZYFrameManager.showScreenshot(getImageSrc())}if(SNAPI_ENABLE){SNAPI.ui("showPermissionDialog",{perms:"email"},a?a:onEmailPermissionDialogClosed)}else{FB.ensureInit(function(){FB.Connect.showPermissionDialog("email",onEmailPermissionDialogClosed);disableAllInput()})}}function onEmailPermissionDialogClosed(a){if(experiment_wmode){ZYFrameManager.hideScreenshot()}var b=false;if(a!=""){b=true;FB.Connect.forceSessionRefresh()}enableAllInput();document.getElementById("flashapp").emailPermissionDialogClosed(b)}function onRequestSent(c,a,b,e){var d=document.getElementById("flashapp");if(d&&d.onRequestSent&&typeof d.onRequestSent=="function"){d.onRequestSent(c,a,b,e)}}function movie(a){return document[a]}var embedStatus=function(b){if(typeof(b)!="undefined"&&typeof(b.success)!="undefined"&&b.success){var a="embedSWFSuccess";var c=2}else{var a="embedSWFFailed";var c=0}if(typeof(recordLoadStats)=="function"){recordLoadStats(a,"",c)}};function embedGameSwf(c,g,b,f,d){var e={allowScriptAccess:"always",wmode:d,allowFullScreen:"true",scale:"noscale"};var a={id:"flashapp",name:"flashapp"};swfobject.embedSWF(c,"flashContent",g,b,"9.0.0","playerProductInstall.swf",f,e,a,embedStatus)}var gpuTestCount=0;var gpuTestNumTextures=0;var gpuTestDriverInfo="";function reportGPUResults(c,b,d){var a=document.getElementById("gputesterapp");a.parentElement.removeChild(a);gpuTestCount=c;gpuTestNumTextures=b;gpuTestDriverInfo=d}function getGPUResults(){return gpuTestCount==0?null:{count:gpuTestCount,numTextures:gpuTestNumTextures,driverInfo:gpuTestDriverInfo}}function openZMC(){_messageCenter.autoPopMC()}function fbc_popup_open(b,d,f,k,c,j){if(f!=null){ZPURCHASE.item.set_title(f)}if(k!=null){ZPURCHASE.item.set_description(k)}if(c!=null){ZPURCHASE.item.set_image_url(c)}var i=function(m){removeModalItem();if(m.status=="settled"){processInAppPurchaseOnClient(b,1,j)}};var h=75;var a=SNAPI.getSNID();var e=SNAPI.getConfig(a).session.user_id;var l=(a==18)?6:1;var g=SNAPI.getCurrentGameId(a);ZPURCHASE.add_to_cart(h,a,e,l,b,1,on_fbc_open,i,d,g)}function fbc_popup_open_no_reload(a,d,g,j,c){if(g!=null){ZPURCHASE.item.set_title(g)}if(j!=null){ZPURCHASE.item.set_description(j)}if(c!=null){ZPURCHASE.item.set_image_url(c)}var i=75;var b=SNAPI.getSNID();var e=SNAPI.getConfig(b).session.user_id;var k=(b==18)?6:1;var h=SNAPI.getCurrentGameId(b);ZPURCHASE.add_to_cart(i,b,e,k,a,1,on_fbc_open,f,d,h);function f(l){removeModalItem();if(l.status=="settled"){var m=document.getElementById("flashapp");if(m&&m.boardExpansionPurchaseSettled&&typeof m.boardExpansionPurchaseSettled=="function"){m.boardExpansionPurchaseSettled(a)}}}}function on_fbc_open(a){addModalItem()}function on_fbc_close(a){removeModalItem();if(a.error_code&&a.error_code!=1383010){ZYFrameManager.navigateTo("money.php?res=error")}else{if(a.status=="settled"){ZYFrameManager.navigateTo("money.php?res=success")}}}var paymentsTimeLeft=300;var paymentsTimer=null;function setPaymentTimeLeft(a){var b=a-1;if(b<=0){return}paymentsTimeLeft=a;paymentsTimer=setTimeout("setPaymentTimeLeft("+b+")",1000)}function killPaymentsTimer(){clearTimeout(paymentsTimer)}function openPaymentsFrame_overlayManager(a){setPaymentTimeLeft(a);ZY.Barrier.once(["zsc_autopopped"],function(){var b=getOverlayManager();b.queueOverlay("payments_sale",openPaymentsFrame,null,null,a)})}function openPaymentsFrame_close_overlayManager(){var a=getOverlayManager();a.onOverlayClosed()}function updateOverlayMangerZSCOpen(){var a=getOverlayManager();a.setZSCOpen()}function updateOverlayMangerZSCClose(){var a=getOverlayManager();a.setZSCClose()}var currentlyOpeningPaymentsFrame=false;var paymentsIsSetup=false;var paymentsFrameRetryListener=null;function getPaymentsFrameInstance(){var e=ZYNGA.PAYMENTS.PAYFRAME.getPayFrameInstance();if(paymentsIsSetup==false){e.addListener(function(){if(currentlyOpeningPaymentsFrame==false){currentlyOpeningPaymentsFrame=true;ZYFrameManager.freezeFlash();if(experiment_wmode){}}},"onAfterIframeDOMReady");e.addListener(function(){if(currentlyOpeningPaymentsFrame==true){currentlyOpeningPaymentsFrame=false;ZYFrameManager.unfreezeFlash();if(experiment_wmode){}}var f=getOverlayManager();f.onOverlayClosed()},"onAfterIframeClose");e.addListener(function(){},"onError");e.addListener(function(){if(paymentsFrameRetryListener!=null){paymentsFrameRetryListener()}},"onTimeout");var d=function(g){if(g&&g.cart&&g.cart.line_items){for(var h=0;h<g.cart.line_items.length;h++){var f=g.cart.line_items[h].item_code;var j=parseInt(g.cart.line_items[h].quantity);processInAppPurchaseOnClient(f,j)}}};e.addListener(d,"onAfterFacebookSuccess");var c=function(){$("#"+this.iframe_id+"_container").width($("#mainBody").width());var f=document.getElementById(this.iframe_id+"_wrapper");f.style.marginTop=0+"px";f.style.top=197+"px"};var a=function(){var l="#"+this.iframe_id+"_wrapper";var g="#"+this.iframe_id+"_action_close";var j=200;$(l).css("margin-top","0px");$(l).css("top",j);var i=$(l).width();var k=$(g).width();var f=$(l).offset();var h=(f.left+i)-(k+4);$(g).offset({top:f.top+2,left:h})};var b=function(){c.call(this);a.call(this)};e.addListener(b,"onAfterIframeResize");paymentsIsSetup=true}return e}var paymentsRetryCnt=0;function openPaymentsFrame(e,i){e=paymentsTimeLeft;killPaymentsTimer();var g=1227;if(paymentsPackageID){g=paymentsPackageID}ZYNGA.PAYMENTS.CONSTANTS.IFRAME_TIMEOUT=10000;if(APP_TEST_MODE){}paymentsFrameRetryListener=function(){++paymentsRetryCnt;if(paymentsRetryCnt<4){setTimeout(function(){retryPaymentsPopupInQueue(e,i)},1000)}};var f=getPaymentsFrameInstance();var h=new Date();var b=ZY.PrepareURL("/payments.php?type=buyframe&d="+h.getTime());var j={page:"custom-inapp-overlay",package_id:g,modal:{close_button:"red"},zugid:paymentsZUGID,query_string_params:{sale_time_remaining:e,app_id:payments_app_id}};var c={page:"custom-inapp-overlay",zugid:paymentsZUGID,package_id:"755000",modal:{close_button:"red"},query_string_params:{type:"icbm",app_id:payments_app_id}};var a=(i&&i=="icbm");if(paymentsZUGID&&typeof paymentsZUGID=="string"){if(a){f.openPaymentPopup(c)}else{f.openPaymentPopup(j)}}else{$.ajax({url:b,context:document.body,success:function(d){var k=$.parseJSON(d);if(k.success){if(a){f.openPaymentPopup(c)}else{f.openPaymentPopup(j)}}else{}}})}}var isInteractive=false;var onInteractiveCallbacks=[];function onInteractive(){isInteractive=true;if(is_zlive){gameMessagesInit()}if(typeof(FB)!=="undefined"){FB.Canvas.setDoneLoading(function(d){recordLoadStats("loadtime",d.time_delta_ms)})}var b=onInteractiveCallbacks.length;for(var a=0;a<b;++a){var c=onInteractiveCallbacks[a];c()}onInteractiveCallbacks=null}function getScreenshot(){var a="";return a}function getFlashApp(){return document.getElementById("flashapp")}function getFacebookId(c,b,d){var a=SNAPI.getSNUIDs([c],b,d);return a}var modalSemaphore=0;var modalFlashTimer=0;var needTimeoutModalRefresh=false;function redrawFlash(){window.setTimeout(function(){var c=getFlashApp();if(!$("#flashFrame").hasClass("offscreen")){ZYFrameManager.showFlash()}var d=c.getAttribute("width");var b=parseInt(d,10);var a="px";if(d.indexOf("%")!==-1){a="%"}c.setAttribute("width",b-1+a);c.setAttribute("width",b+a)},0)}function checkModalStatus(){var c=getFlashApp(),a=true;if(c){if(modalSemaphore>0){if(!$("#innerFlashDiv").hasClass("offscreen")){ZYFrameManager.showScreenshot(getImageSrc())}try{if(c.freezeGame){c.freezeGame();a=false}}catch(b){}}else{if($("#innerFlashDiv").hasClass("offscreen")){ZYFrameManager.hideScreenshot()}try{if(c.thawGame){c.thawGame();if(modalSemaphore<=0){needTimeoutModalRefresh=false}redrawFlash();a=false}}catch(b){}}}if(modalFlashTimer){window.clearTimeout(modalFlashTimer)}modalFlashTimer=a?setTimeout(checkModalStatus,333):0}function addModalItem(){if(experiment_wmode){modalSemaphore++;checkModalStatus()}}function removeModalItem(){if(experiment_wmode&&modalSemaphore>0){modalSemaphore--;checkModalStatus()}}function forceRemoveModalItem(){if(experiment_wmode&&needTimeoutModalRefresh){removeModalItem()}}function beginBackupModelTimeout(){if(experiment_wmode){var a=g_runtimeVars.REQUEST_MFS_FREEZE_TIMEOUT_JS;if(a!=undefined&&a>0){needTimeoutModalRefresh=true;setTimeout(forceRemoveModalItem,a)}}}function onSNAPIInit(){if(SNAPI.getNativeInterface().hasOwnProperty("Canvas")){SNAPI.getNativeInterface().Canvas.setUrlHandler(onUrl)}}function onUrl(a){SNAPI.ZSC.open()}function openGiftOverlay(){var a=getOverlayManager();a.queueOverlay("free_gifts","gifts.php?ref=overlay",null,null)}function openMoneyOverlay(){openPaymentsFrame(0,"icbm")}function closeOverlay(){var a=getOverlayManager();a.onOverlayClosed()}function retryPaymentsPopupInQueue(c,a){var b=getOverlayManager();switch(a){case"payments_sale":b.queueOverlay("payments_sale",openPaymentsFrame,null,null,c);break}}function gameMessagesInit(){var a=SNAPI.GameMessages;a.listen("invite",function(){ZYFrameManager.navigateTo("invite.php")});a.listen("gift",function(){ZYFrameManager.navigateTo("gifts.php")});a.listen("filterFeeds",filterFeedsZDC);a.listen("handleFeed",function(b){gfc.HandleFeed(b.href,function(c){if(c.hasOwnProperty("statusMessage")){b.statusMessage=c.statusMessage}else{if(c.hasOwnProperty("errorMessage")){b.errorMessage=c.errorMessage}}a.send("feedHandled",b)})});a.listen("beforeDialogOpen",ZYFrameManager.freezeFlash);a.listen("afterDialogClose",ZYFrameManager.unfreezeFlash);a.listen("goodsGranted",refreshClientData)}function filterFeedsZDC(a){var b=SNAPI.GameMessages;b.send("feedsFiltered",a)}var gfc=(function(){var a={};a.HandleFeed=function(b,c){b=ZY.PrepareURL(b);$.ajax({url:b+"&_t=json",dataType:"json",success:function(d,e){if(d.itemId&&d.amount&&d.rewardAction){processZDCFeedRedemtionOnClient(d)}if(c){c(d)}},error:function(f,g){var d=f;var e=g}})};return a})();function setPixelTrackSrc(a){setTimeout(function(){$("#pixeltags").attr("src",a)},10)}function refreshClientData(){var a=document.getElementById("flashapp");if(a&&a.runGrantGoodsOnClient&&typeof a.runGrantGoodsOnClient=="function"){a.runGrantGoodsOnClient()}}function processZDCFeedRedemtionOnClient(a){var b=document.getElementById("flashapp");if(b&&b.processZDCFeedRedemtionOnClient&&typeof b.processZDCFeedRedemtionOnClient=="function"){b.processZDCFeedRedemtionOnClient(a)}}function notifyJSClientIsReady(a){}function processInAppPurchaseOnClient(a,c,d){var b=function(){var e=document.getElementById("flashapp");if(e&&e.processInAppPurchaseOnClient&&typeof e.processInAppPurchaseOnClient=="function"&&e.hasPurchaseHandler(a)){e.processInAppPurchaseOnClient(a,c,d)}else{ZYFrameManager.reloadApp()}};if(isInteractive){b()}else{onInteractiveCallbacks.push(b)}}function openWeklySubscriptionPopup(){var a=function(){var b=document.getElementById("flashapp");if(b&&b.openWeklySubscriptionPopup&&typeof b.openWeklySubscriptionPopup=="function"){b.openWeklySubscriptionPopup();return true}else{return false}};if(isInteractive){return a()}return false}function hideSubscriptionLoading(){var a=function(){var b=document.getElementById("flashapp");if(b&&b.hideSubscriptionLoading&&typeof b.hideSubscriptionLoading=="function"){b.hideSubscriptionLoading();return true}else{return false}};if(isInteractive){return a()}return false}function getZFeedBaseImageURL(){return VERSIONED_ASSET_URL+"images/zfeed/"}function zfeedWidgetActionHandler(e,a,g,d){if(e.game_id==75){var b=e.action_links[a].href+"&ajax=1&_t=json";if(g!=null&&g!=""){var f=APP_URL.substr(0,APP_URL.indexOf("//")+2);b=f+g+b.substr(b.indexOf("cityville")+9)}b=ZY.PrepareURL(b);zFeed.setStatus(e.id,"updating","Processing");var c={url:b,dataType:"json",success:function(h,i){if(h){if(h.itemId&&h.amount&&h.rewardAction){processZDCFeedRedemtionOnClient(h);zFeed.setStatus(e.id,"success")}else{zFeed.setStatus(e.id,"failed")}}else{zFeed.setStatus(e.id,"failed","Feed unavailable")}zFeed.delayedFadeOut(e.id,3000,3000);ZStatsCount("zfeed_widget",gameId,gameId,"zfeed_own_click_success")},error:function(j,k){var h=j;var i=k;zFeed.setStatus(e.id,"failed","Feed unavailable");zFeed.delayedFadeOut(e.id,3000,3000);ZStatsCount("zfeed_widget",gameId,gameId,"zfeed_own_click_fail",k)}};if(d){c.timeout=d}$.ajax(c);ZStatsCount("zfeed_widget",gameId,gameId,"zfeed_own_click");return true}ZStatsCount("zfeed_widget",gameId,e.game_id,"zfeed_click");zFeed.setStatus(e.id,"external","");zFeed.delayedFadeOut(e.id,3000,3000);return false}function renderFlashUpgradeExperience(c){ZYFrameManager.showScreenshot(getImageSrc());var d=document.getElementById("flashUpgradePlaceHolder");d.innerHTML="<div id='flashUpgradeContainer' style='top: -600px; position: relative; margin-left: auto; margin-right: auto; background-color: rgb(255, 255, 255); padding: 10px; width: 310px; '><div id='flashUpgradeAlt' ></div></div>";var f=navigator.appName;if(f=="Microsoft Internet Explorer"){}else{d.innerHTML+="<div id='flashUpgradeContainer2' style='top: -766px; left:85px; position: relative; margin-left: auto; margin-right: auto; background-color: transparent; padding: 10px; width: 5px; '></div>"}var a={};var e={menu:"false",allowScriptAccess:"always",wmode:"opaque",allowFullScreen:"true"};var b={id:"flashUpgradeContainer",name:"flashUpgradeContainer",data:c,width:"270",height:"200",bgcolor:"00AAD9"};swfobject.setAdditionalCallbacks(expressInstallCallbackComplete,expressInstallCallbackCancelled,expressInstallCallbackFailed);swfobject.showExpressInstall(b,e,"flashUpgradeAlt")}var expressInstallCallbackComplete=function(){var a=document.getElementById("flashapp");if(a&&a.onExpressInstallerStarted&&typeof a.onExpressInstallerStarted=="function"){a.onExpressInstallerStarted()}ZYFrameManager.hideScreenshot()};var expressInstallCallbackCancelled=function(){var a=document.getElementById("flashapp");if(a&&a.onExpressInstallerCancelled&&typeof a.onExpressInstallerCancelled=="function"){a.onExpressInstallerCancelled()}ZYFrameManager.hideScreenshot()};var expressInstallCallbackFailed=function(){swfobject.expressInstallCallback();var a=document.getElementById("flashapp");if(a&&a.onExpressInstallerFailed&&typeof a.onExpressInstallerFailed=="function"){a.onExpressInstallerFailed()}ZYFrameManager.hideScreenshot()};var openSubscriptionFBPop=function(c){var c="money.php?action=subscribe&fbcPopup=true";var a="invisibleSubscriptioniframe";var f=$("#appFrame #"+a);if(f.length>0){f.html("");var d=$("<iframe/>",{scrolling:"no",border:"0",frameborder:"0",height:"0"});d.appendTo(f);d.attr("src",ZY.PrepareURL(c))}else{var b=$("<div/>",{scrolling:"no",border:"0",frameborder:"0",height:"0"});var d=$("<iframe/>",{scrolling:"no",border:"0",frameborder:"0",height:"0"});d.appendTo(b);d.attr("src",ZY.PrepareURL(c));b.attr("id",a);b.appendTo($("#appFrame"))}};