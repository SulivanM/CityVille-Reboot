(function () { var t = function (ao) { return ZY.PrepareURL(ao) + "&overlayed=true&" + (new Date() - 0) + "#overlay" }; var W, J, M, af, k, ah, o, Z, m, f, T = {}, q; var d = function () { before_cleanup_after_showflash = false; if (Z) { Z.remove() } if (q) { S(q); q = null } }; var y = function (ap) { if (b()) { return false } if (ap && ap.target) { var ao = $(ap.target); if (!ao.is("a")) { ao = ao.parents("a") } var aq = V(ao.attr("href")); if (isSubscriber && ao.attr("href").match(/subscribe/) && $(".play").hasClass("selected") && aq) { return false } m.children("a").parent().removeClass("selected"); ao.parent().addClass("selected"); return false } }; var I = function () { return $("<iframe/>", { scrolling: "no", border: "0", frameborder: "0", height: "0" }) }; var A = function () { W = $("#adFrame"); J = $("#appFrame"); M = $("#flashFrame"); af = $("#loadingFrame"); k = $("#htmlFrame"); ah = $("#gameCardFrame"); f = $("#flashTab") }; $(function () { m = $("#tabs li"); m.children("a").not(".fullpage").click(y); $("#z_lang_button").click(an); A(); mfs_tabs = $("#mfs_tabs a"); mfs_tabs.click(ae)}); var p = function () { window.location.hash = "#notOnFlash"; M.addClass("offscreen"); K(); a() }; var ac = function () { k.addClass("offscreen") }; var e = function () { ah.html(""); ah.addClass("offscreen") }; var R = function () { af.addClass("offscreen") }; var F = function () { R(); p(); e(); k.removeClass("offscreen"); J.removeClass("flashVisible"); if (is_zlive) { J.addClass("zdcFluidCanvas") } }; var N = function () { R(); ac(); p(); ah.removeClass("offscreen"); J.removeClass("flashVisible"); if (is_zlive) { J.addClass("zdcFluidCanvas") } }; var u = function () { ac(); p(); e(); af.show(); af.removeClass("offscreen"); J.removeClass("flashVisible"); if (is_zlive) { J.addClass("zdcFluidCanvas") } }; var h = function () { before_cleanup_after_showflash = true; if (($("#flashFrame")[0].style.display == "none") && (!loading_init_tracked)) { loading_init_tracked = true; n() } ac(); R(); e(); onFrameLoaded(); M.removeClass("offscreen"); U(); if (!is_new_user && show_reac_zsc) { if ($("#flashFrame")[0].style.display == "none" || !has_zsc_popped) { if (typeof SNAPI.ZSC !== "undefined") { SNAPI.ZSC.open(true); has_zsc_popped = true } } } M.show(); J.addClass("flashVisible"); if ($("#appFrame").hasClass("zdcFluidCanvas")) { J.removeClass("zdcFluidCanvas") } Z = o; o = false; m.children("a").parent().removeClass("selected"); f.addClass("selected"); setTimeout(d, 1000); G(); if (!is_zlive) { $("#mainBody").css("height", min_game_height); if (typeof FB !== "undefined") { if (FB && FB.Canvas) { FB.Canvas.getPageInfo(B) } } } }; var B = function (ap) { var ao = min_game_height; if (ap && ap.clientHeight && ap.clientHeight > ao) { ao = ap.clientHeight } $("#mainBody").css("height", ao) }; var G = function () { W.show() }; var a = function () { W.hide() }; var H = window.setInterval(function () { try { var ap = document.getElementById("flashapp"); if (ap && ap.setZBarQueue) { ZY.Barrier.done("flash_loaded"); window.clearTimeout(H) } } catch (ao) { } }, 200); var c, x, O; var ab = function (ar) { var ao = ar.body, aq = ar.documentElement; var ap = Math.min(Math.max(ao.offsetHeight, ao.scrollHeight) + ao.offsetTop, Math.max(aq.offsetHeight, aq.scrollHeight) + aq.offsetTop) + 40; if (aq.clientTop > 0) { ap += (aq.clientTop * 2) } return ap }; var L = function (ar) { var ao = ar.body, ap = ar.documentElement; var aq = Math.max(Math.max(ao.offsetWidth, ao.scrollWidth) + ao.offsetLeft, Math.max(ap.offsetWidth, ap.scrollWidth) + ap.offsetLeft); if (ap.clientLeft > 0) { aq += (ap.clientLeft * 2) } return aq }; var Q = function () { try { if (o == null || (o[0].contentWindow && o[0].contentWindow.location.hash == "#switchToFlash")) { h(); clearInterval(c); c = null; o[0].contentWindow.location.hash = "#switched" } else { x = o[0].contentWindow.document; var ao = ab(x); if (ao != O) { o.height(ao); FB.Canvas.setSize({ height: ao }); O = ao } } } catch (ap) { } }; var am = function () { if (o) { o && o.unbind("load", am); onFrameLoaded(); u(); F() } }; var an = function () { if (!$("#appFrame").hasClass("flashVisible")) { ad(); if (experiment_wmode) { ZYFrameManager.showScreenshot(getImageSrc()) } $("#languageMenuOverlay").show(); return } if ($("#languageMenuOverlay").is(":visible")) { $("#languageMenuOverlay").hide(); if (experiment_wmode) { ZYFrameManager.hideScreenshot() } } else { if (experiment_wmode) { ZYFrameManager.showScreenshot(getImageSrc()) } $("#languageMenuOverlay").show() } }; var V = function (ap, ao) { $("#languageMenuOverlay").hide(); if (V.arguments.length == 1) { ao = false } if (ap.match(/^#switchToFlash/)) { ad(); return true } if (ap.match(/^#loadOffers/)) { g(); return true } if (isSubscriber && ap.match(/subscribe/) && ap.match(/tab/) && $(".play").hasClass("selected")) { if (openWeklySubscriptionPopup()) { return true } } A(); if (ap.match(/gamecard.php/) && ap.match(/action=facebook/)) { al(ap); return true } if (T[ap]) { if (o) { Z = o; d() } o = T[ap]; q = ap; T[ap] = null; o.attr("height", "").removeClass("preloaded"); am() } else { if (!ao) { u() } if (!o) { o = I().appendTo(k) } o.attr("src", t(ap)); o.load(am) } x = null; O = 0; c = setInterval(Q, 500); return true }; var P = function () { if (typeof (FB) !== undefined) { FB.Canvas.startTimer() } }; var n = function () { recordLoadStats("load_playtab", "", 1); recordLoadStats("loadinginit", "", 0); if (SNAPI.isInit()) { P() } else { SNAPI.registerOnload(P) } }; var ad = function () { if (ak) { v() } c && clearInterval(c); c = null; h() }; var w = function (ao) { if (experiment_wmode) { ZYFrameManager.showScreenshot(getImageSrc()) } if (ao) { V("offers.php?url=" + ao) } }; var Y = function (ao) { if (experiment_wmode) { ZYFrameManager.hideScreenshot() } }; var g = function () { var ao = clientId; if (is_zlive) { ao = zdcClientId } ZPAYMENTS.get_offers(gameId, snid, snuid, ao, w, Y, fb_app_id) }; var al = function (ap) { u(); var ao = ap.substring(ap.indexOf("gamecard.php")); $.get(ao, function (aq) { ah.html(aq); onFrameLoaded(); N() }) }; var s = []; var S = function (ap) { var ao = function () { var aq = I(); aq.addClass("preloaded").attr("src", t(ap)).appendTo(k).load(function () { T[ap] = aq }) }; s.push(ao) }; var X = function () { A(); var ao = s; s = []; setTimeout(function () { for (var ap = 0; ap < ao.length; ++ap) { ao[ap]() } }, 5000) }; var v = function () { document.location.reload(true) }; var ae = function (ap) { $("div[id^=mfs_]").not("#mfs_tabs").addClass("hiddenTab"); $('div[id*="mfs_' + ap.currentTarget.id + '"]').removeClass("hiddenTab"); var ao = $("#mfs_tabs li"); ao.removeClass("selected"); for (i = 0; i < ao.length; i++) { if (ao[i].querySelector("a").id == ap.currentTarget.id) { $(ao[i]).addClass("selected"); break } } }; var K = function () { $("#innerFlashDiv").addClass("offscreen"); E() }; var U = function () { E(); $("#innerFlashDiv").removeClass("offscreen"); try { if ((typeof (FB) !== "undefined") && (typeof (FB.Canvas.showFlashElement) === "function")) { FB.Canvas.showFlashElement(document.getElementById("flashapp")) } else { $("#flashapp").css("visibility", "") } } catch (ao) { $("#flashapp").css("visibility", "") } }; var ag = function () { var ao = $("#zfeed_widget"); if (ao != null) { ao.hide() } }; var r = function () { var ao = $("#zfeed_widget"); if (ao != null) { ao.show() } }; var ai = function (ao) { if (ao) { $("#screenshotFrame img").attr("src", ao) } var ap = $("#screenshotFrame img").attr("src"); if (!ap.match(/https?:/i)) { $("#screenshotFrame").css({ margin: "0 auto", "margin-left": "", "margin-right": "", width: "100%", height: "100%" }) } else { $("#screenshotFrame").css({ margin: "", "margin-left": "auto", "margin-right": "auto", width: "1280px", height: "100%" }) } $("#screenshotFrame").removeClass("offscreen"); ag(); K() }; var aa = function () { $("#screenshotFrame").addClass("offscreen"); var ao = $("#screenshotFrame img").attr("src"); if (!ao.match(/https?:/i)) { $("#screenshotFrame img").attr("src", "") } r(); U() }; var aj = function () { addModalItem() }; var j = function () { removeModalItem() }; var E = function () { var ao = document.getElementById("flashUpgradePlaceHolder"); if (ao != null) { ao.innerHTML = "" } }; var l = function () { ak = 1 }; var ak = 0; var z = false; var D = function () { z = true }; var C = function () { z = false }; var b = function () { return z }; window.ZYFrameManager = { navigateTo: V, switchToFlash: ad, openIFrame: V, preloadUrl: S, reloadApp: v, readyToPreload: X, showScreenshot: ai, hideScreenshot: aa, loadOffers: g, showFlash: h, freezeFlash: aj, unfreezeFlash: j, setIsShowingAds: D, unsetIsShowingAds: C, getIsShowingAds: b, flagReloadOnSwitchToFlash: l } })();